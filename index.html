<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Aangifte Systeem v2.0 - Evi de Vries</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        body { background-color: #0a0e14; color: #d1d1d1; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .main-wrapper { display: flex; gap: 20px; max-width: 1300px; margin: auto; flex-wrap: wrap; height: 90vh; }
        
        #chat-section { flex: 1; min-width: 350px; background: #1c222d; border: 2px solid #2980b9; display: flex; flex-direction: column; border-radius: 8px; overflow: hidden; }
        #chat-header { padding: 15px; background: #2980b9; color: white; text-align: center; font-weight: bold; }
        #messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #f4f7f6; }
        
        #aangifte-section { flex: 1.2; min-width: 400px; background: #ffffff; border: 2px solid #bdc3c7; display: flex; flex-direction: column; padding: 15px; border-radius: 8px; color: #333; }
        
        .bubble { max-width: 85%; padding: 12px; border-radius: 15px; font-size: 0.95em; line-height: 1.4; animation: fadeIn 0.3s; }
        .bot { align-self: flex-start; background: #e8e8e8; color: #2c3e50; border-bottom-left-radius: 2px; }
        .user-msg { align-self: flex-end; background: #2980b9; color: white; border-bottom-right-radius: 2px; }
        
        .feed-item { background: #f9f9f9; border: 1px solid #ddd; padding: 12px; margin-top: 15px; border-radius: 8px; }
        .pv-text { color: #2c3e50; white-space: pre-wrap; margin-bottom: 8px; font-size: 0.9em; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .fb-section { color: #d35400; font-size: 0.85em; font-weight: bold; }

        .input-area { display: flex; padding: 15px; background: #fff; border-top: 1px solid #eee; }
        input[type="text"], textarea { background: #fff; border: 1px solid #ccc; color: #333; padding: 10px; border-radius: 4px; }
        textarea { width: 100%; min-height: 120px; box-sizing: border-box; border: 2px solid #2980b9; margin-bottom: 10px; }
        
        button { background: #2980b9; color: white; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; border-radius: 4px; }
        .btn-pv { background: #27ae60; width: 100%; font-size: 1.1em; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        h2 { margin-top: 0; font-size: 1.2em; color: #2980b9; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div id="chat-section">
        <div id="chat-header">AANGIFTE: EVI DE VRIES</div>
        <div id="messages">
            <div class="bubble bot">Hallo... ik ben Evi. Sorry dat ik zo emotioneel ben, maar ik ben de hele ochtend al aan het huilen. Mijn mooie fiets is gestolen...</div>
        </div>
        <div class="input-area">
            <input type="text" id="botInput" style="flex:1; margin-right: 5px;" placeholder="Stel een vraag..." onkeypress="if(event.key==='Enter') chatWithBot()">
            <button onclick="chatWithBot()">STEL VRAAG</button>
        </div>
    </div>

    <div id="aangifte-section">
        <h2>OFFICIÃ‹LE AANGIFTE</h2>
        <textarea id="pvInput" placeholder="Typ de verklaring uit op basis van Evi's verhaal..."></textarea>
        <button class="btn-pv" onclick="submitToFirebase()">OPSLAAN IN AANGIFTE</button>
        <div id="feed-container" style="flex:1; overflow-y:auto; margin-top:10px;"></div>
        <button onclick="clearAll()" style="font-size: 0.7em; background: #95a5a6; margin-top:10px; color: white;">WIS FEED</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC-Of0AUOd-kVo2RKxYc-68Gr-RO4HdRk0",
        authDomain: "q2aangifteles2.firebaseapp.com",
        databaseURL: "https://q2aangifteles2-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "q2aangifteles2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const responses = {
        wie: [
            "Ik ben Evi de Vries. Ik ben geboren op vier november tweeduizend twee in Maastricht. Ik mis Limburg nu wel een beetje.",
            "Mijn volledige naam is Evi de Vries. Ik ben eenentwintig jaar geleden geboren in Maastricht. Hier in Utrecht voel ik me nu even niet zo thuis.",
            "Evi de Vries... vier-elf-tweeduizend twee. Ik kom oorspronkelijk uit Maastricht, maar ik woon nu pas een paar maanden hier op mezelf."
        ],
        fiets: [
            "Het was mijn witte Gazelle Esprit. Ik heb elke euro drie keer omgedraaid om die fiets te kunnen kopen. Hij was zeshonderdvijftig euro waard... ik kan dat nooit meer opnieuw betalen.",
            "Een witte damesfiets van Gazelle. Hij was mijn alles, ik ging er overal mee naartoe. Nu heb ik helemaal niets meer.",
            "Mijn witte Gazelle... er zat zo'n handig mandje op. Hij was nog zo nieuw en glimmend. Ik ben er zo kapot van."
        ],
        waar: [
            "Ik woon op de Vredenburg vierentwintig-B, midden in het centrum. Ik dacht dat er hier genoeg sociale controle zou zijn, maar blijkbaar niet.",
            "Vredenburg vierentwintig-B... daar voor de deur stond hij vast aan de lantaarnpaal. Ik kan het nog steeds niet geloven als ik naar die lege plek kijk.",
            "Mijn adres is Vredenburg vierentwintig-B. Ik had de fiets gisteravond rond acht uur nog gezien toen ik thuiskwam van werk."
        ],
        nacht: [
            "Ik lag in bed en hoorde rond drie uur een scooter. Ik had nooit verwacht dat ze mijn fiets aan het meenemen waren. Ik voel me zo stom dat ik niet ben gaan kijken.",
            "Ik werd wakker van een scooter en hoorde voetstappen. Daarna dat nare geluid van metaal dat kraakt. Ik was te bang om uit het raam te kijken en nu is hij weg.",
            "Die scooter bleef maar stationair draaien... en toen hoorde ik die klik en dat metaalachtige geluid. Ik had iets moeten doen, maar ik durfde niet."
        ],
        slot: [
            "Mijn dikke cijferslot lag gewoon doormidden op de stoep. Ik moest huilen toen ik het zag liggen.",
            "Ze hebben de kabel gewoon doorgeknipt alsof het niets was. Je ziet al die kleine ijzerdraadjes zitten bij het snijvlak. Het ziet er zo gewelddadig uit.",
            "Het slot is helemaal kapot. De kabel is doorgeknipt met een tang, dat zie je aan die platte, scherpe randjes aan het uiteinde."
        ],
        onzin: [
            "Sorry, ik kan me even niet zo goed concentreren door al dat huilen. Wat vroeg u precies?",
            "Het spijt me... ik ben er met mijn hoofd niet helemaal bij. Ik wil gewoon mijn fiets terug.",
            "Kunt u die vraag nog een keer stellen? Ik ben een beetje in de war door alles."
        ]
    };

    function chatWithBot() {
        const input = document.getElementById('botInput');
        const val = input.value.trim().toLowerCase();
        if(!val) return;

        addBubble(input.value, 'user-msg');
        input.value = '';

        setTimeout(() => {
            let reply;
            const getRnd = (arr) => arr[Math.floor(Math.random() * arr.length)];
            
            if (val.includes("wie") || val.includes("naam") || val.includes("heet") || val.includes("geboren") || val.includes("datum")) reply = getRnd(responses.wie);
            else if (val.includes("fiets") || val.includes("merk") || val.includes("kleur") || val.includes("waarde")) reply = getRnd(responses.fiets);
            else if (val.includes("waar") || val.includes("adres") || val.includes("woon") || val.includes("straat")) reply = getRnd(responses.waar);
            else if (val.includes("nacht") || val.includes("scooter") || val.includes("gehoord")) reply = getRnd(responses.nacht);
            else if (val.includes("slot") || val.includes("kabel") || val.includes("knippen")) reply = getRnd(responses.slot);
            else reply = getRnd(responses.onzin);
            
            addBubble(reply, 'bot');
        }, 600);
    }

    function addBubble(text, side) {
        const div = document.createElement('div');
        div.className = `bubble ${side}`;
        div.innerText = text;
        const msgContainer = document.getElementById('messages');
        msgContainer.appendChild(div);
        msgContainer.scrollTop = msgContainer.scrollHeight;
    }

    function submitToFirebase() {
        const tekst = document.getElementById('pvInput').value.trim();
        if(!tekst) return;
        db.ref('posts').push({
            tekst: tekst,
            feedback: "",
            timestamp: Date.now()
        }).then(() => { 
            document.getElementById('pvInput').value = ''; 
        });
    }

    function addFeedback(id) {
        const fb = document.getElementById('fb-in-'+id).value;
        if(!fb) return;
        db.ref('posts/' + id).update({ feedback: fb });
    }

    function clearAll() { if(confirm("Aangiftes wissen?")) db.ref('posts').remove(); }

    db.ref('posts').on('value', (snap) => {
        const container = document.getElementById('feed-container');
        container.innerHTML = "<h2>BINNENGEKOMEN AANGIFTES</h2>";
        const data = snap.val();
        if(data) {
            Object.keys(data).reverse().forEach(id => {
                const item = data[id];
                const div = document.createElement('div');
                div.className = 'feed-item';
                div.innerHTML = `
                    <div class="pv-text">${item.tekst}</div>
                    <div class="fb-section">FB: ${item.feedback || 'Nog geen feedback...'}</div>
                    <div style="display:flex; gap:5px; margin-top:5px;">
                        <input type="text" id="fb-in-${id}" placeholder="Geef feedback..." style="font-size:0.7em; flex:1;">
                        <button onclick="addFeedback('${id}')" style="font-size:0.6em; background:#34495e; color:white;">OK</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }
    });
</script>
</body>
</html>
