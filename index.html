<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Aangifte Systeem v2.0 - Evi de Vries</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        body { background-color: #0a0e14; color: #d1d1d1; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .main-wrapper { display: flex; gap: 20px; max-width: 1300px; margin: auto; flex-wrap: wrap; height: 90vh; }
        
        #chat-section { flex: 1; min-width: 350px; background: #1c222d; border: 2px solid #2980b9; display: flex; flex-direction: column; border-radius: 8px; overflow: hidden; }
        #chat-header { padding: 15px; background: #2980b9; color: white; text-align: center; font-weight: bold; }
        #messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #f4f7f6; }
        
        #dossier-section { flex: 1.2; min-width: 400px; background: #ffffff; border: 2px solid #bdc3c7; display: flex; flex-direction: column; padding: 15px; border-radius: 8px; color: #333; }
        
        .bubble { max-width: 85%; padding: 12px; border-radius: 15px; font-size: 0.95em; line-height: 1.4; animation: fadeIn 0.3s; }
        .bot { align-self: flex-start; background: #e8e8e8; color: #2c3e50; border-bottom-left-radius: 2px; }
        .user-msg { align-self: flex-end; background: #2980b9; color: white; border-bottom-right-radius: 2px; }
        
        .feed-item { background: #f9f9f9; border: 1px solid #ddd; padding: 12px; margin-top: 15px; border-radius: 8px; }
        .pv-text { color: #2c3e50; white-space: pre-wrap; margin-bottom: 8px; font-size: 0.9em; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .fb-section { color: #d35400; font-size: 0.85em; font-weight: bold; }

        .input-area { display: flex; padding: 15px; background: #fff; border-top: 1px solid #eee; }
        input[type="text"], textarea { background: #fff; border: 1px solid #ccc; color: #333; padding: 10px; border-radius: 4px; }
        textarea { width: 100%; min-height: 120px; box-sizing: border-box; border: 2px solid #2980b9; margin-bottom: 10px; }
        
        button { background: #2980b9; color: white; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; border-radius: 4px; }
        .btn-pv { background: #27ae60; width: 100%; font-size: 1.1em; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        h2 { margin-top: 0; font-size: 1.2em; color: #2980b9; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div id="chat-section">
        <div id="chat-header">AANGIFTE: EVI DE VRIES</div>
        <div id="messages">
            <div class="bubble bot">Hallo. Ik ben Evi. Ik kom aangifte doen omdat mijn fiets weg is. Ik vind het een beetje spannend om hier te zijn.</div>
        </div>
        <div class="input-area">
            <input type="text" id="botInput" style="flex:1; margin-right: 5px;" placeholder="Stel een vraag..." onkeypress="if(event.key==='Enter') chatWithBot()">
            <button onclick="chatWithBot()">STEL VRAAG</button>
        </div>
    </div>

    <div id="dossier-section">
        <h2>OFFICIEEL DOSSIER</h2>
        <textarea id="pvInput" placeholder="Typ de verklaring uit op basis van het verhoor..."></textarea>
        <button class="btn-pv" onclick="submitToFirebase()">OPSLAAN IN DOSSIER</button>
        <div id="feed-container" style="flex:1; overflow-y:auto; margin-top:10px;"></div>
        <button onclick="clearAll()" style="font-size: 0.7em; background: #95a5a6; margin-top:10px; color: white;">WIS FEED</button>
    </div>
</div>

<script>
    // --- FIREBASE SETUP ---
    const firebaseConfig = {
        apiKey: "AIzaSyC-Of0AUOd-kVo2RKxYc-68Gr-RO4HdRk0",
        authDomain: "q2aangifteles2.firebaseapp.com",
        databaseURL: "https://q2aangifteles2-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "q2aangifteles2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- EVI RESPONSES ---
    const responses = {
        wie: [
            "Ik heet Evi de Vries. Ik ben drieÃ«ntwintig jaar oud en ik woon pas sinds kort in Utrecht.",
            "Mijn naam is Evi de Vries. Ik heb mijn identiteitsbewijs hier in mijn tas zitten als u dat wilt zien.",
            "Ik ben Evi. Mijn achternaam is de Vries. Ik ben geboren op twaalf maart tweeduizend twee."
        ],
        fiets: [
            "Het was een witte Gazelle Esprit. Ik heb er heel lang voor gespaard, hij was zeshonderdvijftig euro waard.",
            "De fiets is wit en van het merk Gazelle. Er zat een klein rekje voorop voor mijn tas. Hij was nog bijna nieuw.",
            "Mijn witte Gazelle... ik ben er altijd zo voorzichtig mee geweest. Hij kostte zeshonderdvijftig euro."
        ],
        waar: [
            "Ik woon aan de Grachtengordel-West honderdtwaalf. De fiets stond daar voor de deur aan een lantaarnpaal.",
            "De diefstal was bij mijn huis op de Grachtengordel-West. Ik had hem gisteravond netjes vastgezet.",
            "Aan de Grachtengordel-West honderdtwaalf. Daar bij die grote lantaarnpaal voor mijn raam."
        ],
        nacht: [
            "Het was vannacht rond een uur of drie. Ik hoorde ineens het geluid van een scooter die stilhield onder mijn raam.",
            "Ik werd wakker van een ronkende scooter. Daarna hoorde ik voetstappen en een heel akelig geluid van metaal op metaal.",
            "Ik hoorde eerst die scooter en daarna voetstappen op de stoep. Toen hoorde ik gekraak van metaal en even later reed de scooter weer weg."
        ],
        slot: [
            "Mijn cijferslot lag vanmorgen gewoon op de grond. De kabel is helemaal doormidden geknipt.",
            "Ze hebben het dikke staalslot doorgeknipt. Op de plek waar hij door is zie je allemaal van die kleine zilveren ijzerdraadjes uitsteken.",
            "Het slot is kapot. De kabel heeft zo'n plat snijvlak waar je precies kunt zien dat er een tang is gebruikt."
        ],
        onzin: [
            "Oeps, sorry... ik begrijp die vraag niet zo goed. Bedoelt u iets over mijn fiets?",
            "Ik weet niet goed wat ik daarop moet zeggen. Ik ben nog een beetje ontdaan van de diefstal.",
            "Kunt u dat misschien nog een keer uitleggen? Ik wil u graag helpen met het dossier."
        ]
    };

    // --- CHAT FUNCTIE ---
    function chatWithBot() {
        const input = document.getElementById('botInput');
        const val = input.value.trim().toLowerCase();
        if(!val) return;

        addBubble(input.value, 'user-msg');
        input.value = '';

        setTimeout(() => {
            let reply;
            const getRnd = (arr) => arr[Math.floor(Math.random() * arr.length)];
            
            if (val.includes("wie") || val.includes("naam") || val.includes("heet")) reply = getRnd(responses.wie);
            else if (val.includes("fiets") || val.includes("merk") || val.includes("kleur") || val.includes("waarde")) reply = getRnd(responses.fiets);
            else if (val.includes("waar") || val.includes("adres") || val.includes("woon")) reply = getRnd(responses.waar);
            else if (val.includes("nacht") || val.includes("scooter") || val.includes("gehoord")) reply = getRnd(responses.nacht);
            else if (val.includes("slot") || val.includes("kabel") || val.includes("knippen")) reply = getRnd(responses.slot);
            else {
                reply = getRnd(responses.onzin);
            }
            addBubble(reply, 'bot');
        }, 600);
    }

    function addBubble(text, side) {
        const div = document.createElement('div');
        div.className = `bubble ${side}`;
        div.innerText = text;
        const msgContainer = document.getElementById('messages');
        msgContainer.appendChild(div);
        msgContainer.scrollTop = msgContainer.scrollHeight;
    }

    // --- DOSSIER FUNCTIES ---
    function submitToFirebase() {
        const tekst = document.getElementById('pvInput').value.trim();
        if(!tekst) return;
        db.ref('posts').push({
            tekst: tekst,
            feedback: "",
            timestamp: Date.now()
        }).then(() => { document.getElementById('pvInput').value = ''; });
    }

    function addFeedback(id) {
        const fb = document.getElementById('fb-in-'+id).value;
        if(!fb) return;
        db.ref('posts/' + id).update({ feedback: fb });
    }

    function clearAll() { if(confirm("Feed wissen?")) db.ref('posts').remove(); }

    // --- LIVE FEED ---
    db.ref('posts').on('value', (snap) => {
        const container = document.getElementById('feed-container');
        container.innerHTML = "<h2>INGELEVERDE VERKLARINGEN</h2>";
        const data = snap.val();
        if(data) {
            Object.keys(data).reverse().forEach(id => {
                const item = data[id];
                const div = document.createElement('div');
                div.className = 'feed-item';
                div.innerHTML = `
                    <div class="pv-text">${item.tekst}</div>
                    <div class="fb-section">FB: ${item.feedback || 'Nog geen feedback...'}</div>
                    <div style="display:flex; gap:5px; margin-top:5px;">
                        <input type="text" id="fb-in-${id}" placeholder="Geef feedback..." style="font-size:0.7em; flex:1;">
                        <button onclick="addFeedback('${id}')" style="font-size:0.6em; background:#34495e; color:white;">OK</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }
    });
</script>
</body>
</html>
